DEV_APP_ID="Developer ID Application: Roland Rabien (3FS7DJDG38)"
DEV_INST_ID="Developer ID Installer: Roland Rabien (3FS7DJDG38)"

PASSWORD="wtow-zpjo-nftf-tpzc"
USERNAME="itunes@rabien.com"

rm -R bin
mkdir bin

pushd .
cd "../../PAPU/plugin/Builds/MacOSX"
xcodebuild -configuration Release || exit 1
popd

pushd .
cd "../../RP2A03/plugin/Builds/MacOSX"
xcodebuild -configuration Release || exit 1
popd

pushd .
cd "../../SID/plugin/Builds/MacOSX"
xcodebuild -configuration Release || exit 1
popd

pushd .
cd "../../SN76489/plugin/Builds/MacOSX"
xcodebuild -configuration Release || exit 1
popd

pushd .
cd "../../Voc/plugin/Builds/MacOSX"
xcodebuild -configuration Release || exit 1
popd

pushd .
cd "../plugins/slOscilloscope/Builds/MacOSX"
xcodebuild -configuration Release || exit 1
popd

pushd .
cd "../plugins/Spectrum Analyzer/Builds/MacOSX"
xcodebuild -configuration Release || exit 1
popd

pushd .
cd "../plugins/Tone Generator/Builds/MacOSX"
xcodebuild -configuration Release || exit 1
popd

pushd .
cd "../plugins/Channel Mute/Builds/MacOSX"
xcodebuild -configuration Release || exit 1
popd

pushd .
cd "../plugins/Maths/Builds/MacOSX"
xcodebuild -configuration Release || exit 1
popd

pushd .
cd "../plugins/AB Tester/Builds/MacOSX"
xcodebuild -configuration Release || exit 1
popd

pushd .
cd "../plugins/AddInvert/Builds/MacOSX"
xcodebuild -configuration Release || exit 1
popd

pushd .
cd "../plugins/SFX8/Builds/MacOSX"
xcodebuild -configuration Release || exit 1
popd

pwd
cp -R ~/Library/Audio/Plug-Ins/VST/PAPU.vst bin
cp -R ~/Library/Audio/Plug-Ins/VST/RP2A03.vst bin
cp -R ~/Library/Audio/Plug-Ins/VST/SID.vst bin
cp -R ~/Library/Audio/Plug-Ins/VST/SN76489.vst bin
cp -R ~/Library/Audio/Plug-Ins/VST/Voc.vst bin
cp -R ~/Library/Audio/Plug-Ins/VST/Oscilloscope.vst bin
cp -R ~/Library/Audio/Plug-Ins/VST/SpectrumAnalyzer.vst bin
cp -R ~/Library/Audio/Plug-Ins/VST/ToneGenerator.vst bin
cp -R ~/Library/Audio/Plug-Ins/VST/ChannelMute.vst bin
cp -R ~/Library/Audio/Plug-Ins/VST/Maths.vst bin
cp -R ~/Library/Audio/Plug-Ins/VST/ABTester.vst bin
cp -R ~/Library/Audio/Plug-Ins/VST/AddInvert.vst bin
cp -R ~/Library/Audio/Plug-Ins/VST/SFX8.vst bin

cp -R ~/Library/Audio/Plug-Ins/Components/PAPU.component bin
cp -R ~/Library/Audio/Plug-Ins/Components/RP2A03.component bin
cp -R ~/Library/Audio/Plug-Ins/Components/SID.component bin
cp -R ~/Library/Audio/Plug-Ins/Components/SN76489.component bin
cp -R ~/Library/Audio/Plug-Ins/Components/Voc.component bin
cp -R ~/Library/Audio/Plug-Ins/Components/Oscilloscope.component bin
cp -R ~/Library/Audio/Plug-Ins/Components/SpectrumAnalyzer.component bin
cp -R ~/Library/Audio/Plug-Ins/Components/ToneGenerator.component bin
cp -R ~/Library/Audio/Plug-Ins/Components/ChannelMute.component bin
cp -R ~/Library/Audio/Plug-Ins/Components/Maths.component bin
cp -R ~/Library/Audio/Plug-Ins/Components/ABTester.component bin
cp -R ~/Library/Audio/Plug-Ins/Components/AddInvert.component bin
cp -R ~/Library/Audio/Plug-Ins/Components/SFX8.component bin

cd bin/VST
for filename in ./*.vst; do
  codesign --force -s "$DEV_APP_ID" -v "$filename" --deep --strict --options=runtime
  spctl -vvv --assess --type exec "$filename"
  codesign -dvv "$filename"
  codesign -vvv --deep --strict "$filename"
 
  notarize "$filename" "$USERNAME" "$PASSWORD"
done
cd ../..

cd bin
zip -r PAPU_Mac.zip PAPU.vst PAPU.component
zip -r RP2A03_Mac.zip RP2A03.vst RP2A03.component
zip -r SID_Mac.zip SID.vst SID.component
zip -r SN76489_Mac.zip SN76489.vst SN76489.component
zip -r Voc_Mac.zip Voc.vst Voc.component
zip -r Oscilloscope_Mac.zip Oscilloscope.vst Oscilloscope.component
zip -r SpectrumAnalyzer_Mac.zip SpectrumAnalyzer.vst SpectrumAnalyzer.component
zip -r ToneGenerator_Mac.zip ToneGenerator.vst ToneGenerator.component
zip -r ChannelMute_Mac.zip ChannelMute.vst ChannelMute.component
zip -r Maths_Mac.zip Maths.vst Maths.component
zip -r ABTester_Mac.zip ABTester.vst ABTester.component
zip -r AddInvert_Mac.zip AddInvert.vst AddInvert.component
zip -r SFX8_Mac.zip SFX8.vst SFX8.component
zip -r All_Mac.zip *.vst *.component
cd ..
